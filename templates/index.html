<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Jakub Domagała - Portfolio</title>
    <!-- Google Fonts Import -->
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;700&display=swap" rel="stylesheet">
    <!-- Link to your CSS file -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
    <!-- Meta Tag for Responsiveness -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>

<body>
    <!-- Navbar -->
    <nav class="navbar">
        <ul class="nav-menu">
            <li>
                <a href="#hello" class="nav-link">
                    Hello!
                </a>
            </li>
            <li>
                <a href="#about" class="nav-link">
                    About Me
                </a>
            </li>
            <li>
                <a href="#portfolio" class="nav-link">
                    Portfolio
                </a>
            </li>
            <li>
                <a href="#contact" class="nav-link">
                    Contact
                </a>
            </li>
        </ul>
    </nav>

    <!-- Main Container -->
    <section class="container">
        <!-- Hello Section -->
        <section id="hello" class="hello">

            <p class="greeting">
                Hello, I’m Jakub Domagała
                <img src="/static/images/hand.svg" alt="waving hand">
            </p>
            <h1 class="title">
                Software Engineer
            </h1>

            <ul class="socials">
                <!-- Social Icons -->
                <!-- (Your existing social links and SVGs) -->
            </ul>
        </section>

        <!-- About Section -->
        <section id="about" class="about-me">
            <div class="main">
                <div class="about-me-text">
                    <p class="title">About Me</p>
                    <p class="description text">I am a Software Engineer with experience in the automotive, fintech, and
                        high-performance computing (HPC)
                        industries. I have worked on developing and maintaining software systems that enhance
                        functionality
                        and
                        efficiency. Additionally, I have some background in computer graphics, contributing to the
                        creation
                        of
                        user interfaces and visual components.</p>
                </div>
                <img src="/static/images/portrait.svg" alt="my picture" class="image">
            </div>
            <div class="skills">
                <p class="subtitle">Skills</p>
                <ul class="list">
                    <li><img src="/static/images/c++.svg" alt="c++ logo" class="icon"></li>
                    <li><img src="/static/images/python.svg" alt="python logo" class="icon"></li>
                    <li><img src="/static/images/vulkan.svg" alt="vulkan logo" class="icon"></li>
                    <li><img src="/static/images/cmake.svg" alt="cmake logo" class="icon"></li>
                    <li><img src="/static/images/git.svg" alt="git logo" class="icon"></li>
                    <li><img src="/static/images/docker.svg" alt="docker logo" class="icon"></li>
                    <li><img src="/static/images/mpi.svg" alt="mpi logo" class="icon"></li>
                </ul>
            </div>
        </section>

        <!-- Portfolio Section -->
        <section id="portfolio" class="portfolio">
            <p class="title">Portfolio</p>
            <div class="project">
                <img src="/static/images/looper.svg" alt="looper screenshot" class="image">
                <div class="description right">
                    <p class="subtitle">Looper</p>
                    <p class="text">
                        Looper is a game engine that includes an integrated editor and a 2D game environment complete
                        with a
                        level editor, all built with modern C++20. It uses Vulkan for efficient rendering and
                        incorporates
                        ImGui and GLFW3 to manage the user interface and handle window/input operations. Looper supports
                        both Ubuntu and Windows platforms
                    </p>
                    <button class="button button-text">Read more</button>
                </div>
            </div>

            <div class="project">
                <div class="description left">
                    <p class="subtitle">Shady</p>
                    <p class="text">
                        Shady is a 3D rendering engine built with C++20 and Vulkan for high-performance graphics. It
                        utilizes ImGui for intuitive user interfaces and GLFW3 for window and input management.
                        Compatible with both Ubuntu and Windows.
                    </p>
                    <button class="button button-text">Read more</button>
                </div>
                <img src="/static/images/shady.svg" alt="shady screenshot" class="image">
            </div>

            <div class="project">
                <img src="/static/images/static-analysis.svg" alt="static-analysis screenshot" class="image">
                <div class="description right">
                    <p class="subtitle">Static Analysis</p>
                    <p class="text">
                        GitHub action designed for C++ projects that performs static analysis using cppcheck and
                        clang-tidy. Depending on trigger type it produces either console output (for push) or PR
                        comments (for pull request) with code snippets.
                    </p>
                    <button class="button button-text">Read more</button>
                </div>
            </div>

            <div class="project">
                <div class="description left">
                    <p class="subtitle">Compile Result</p>
                    <p class="text">
                        Compile Result is a GitHub Action that analyzes build output for C/C++ applications and comments
                        on pull requests with any detected issues, including relevant code snippets and descriptions.
                    </p>
                    <button class="button button-text">Read more</button>
                </div>
                <img src="/static/images/compile-result.svg" alt="compile-result screenshot" class="image">
            </div>
        </section>

        <!-- Contact Section -->
        <section id="contact" class="contact">
            <div class="content">
                <p class="title">Get in Touch</p>
                <p class="text">
                    Have any questions or interested in working together? Fill out the form, and I will get back to you
                    soon!
                </p>

                <form id="contact-form" class="contact-form" method="POST" action="{{ url_for('handle_contact') }}"
                    novalidate>
                    <div class="form">
                        <label for="email">Email</label>
                        <input class="input-field" type="email" id="email" name="email" required>
                        <small class="error-message" id="email-error"></small>
                    </div>

                    <div class="form">
                        <label for="message">Message</label>
                        <textarea class="input-field" id="message" name="message" rows="5" required></textarea>
                        <small class="error-message" id="message-error"></small>
                    </div>
                    <button class="submit-btn button-text" type="submit">
                        <img src="{{ url_for('static', filename='images/chevron.svg') }}" alt="Send">
                        Send message
                    </button>
                </form>

                <!-- Success/Error Messages -->
                {% if success %}
                <div class="success-message">
                    {{ success }}
                </div>
                {% endif %}
                {% if error %}
                <div class="error-message">
                    {{ error }}
                </div>
                {% endif %}
            </div>
            <img src="{{ url_for('static', filename='images/contact.svg') }}" alt="contact image">
        </section>
    </section>

    <!-- JavaScript for AJAX Submission -->
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const form = document.getElementById('contact-form');
            const emailInput = document.getElementById('email');
            const messageInput = document.getElementById('message');
            const emailError = document.getElementById('email-error');
            const messageError = document.getElementById('message-error');

            form.addEventListener('submit', function (e) {
                e.preventDefault(); // Prevent the default form submission
                console.log("Form submit event triggered"); // Debugging

                // Clear previous messages and error states
                emailError.innerText = '';
                messageError.innerText = '';
                emailInput.classList.remove('input-error');
                messageInput.classList.remove('input-error');

                // Gather form data
                const formData = {
                    email: emailInput.value.trim(),
                    message: messageInput.value.trim()
                };

                console.log("Form Data:", formData); // Debugging

                // Client-side validation
                let hasError = false;
                if (!formData.email) {
                    emailError.innerText = 'Email is required.';
                    emailInput.classList.add('input-error');
                    hasError = true;
                } else if (!validateEmail(formData.email)) {
                    emailError.innerText = 'Please enter a valid email address.';
                    emailInput.classList.add('input-error');
                    hasError = true;
                }

                if (!formData.message) {
                    messageError.innerText = 'Message is required.';
                    messageInput.classList.add('input-error');
                    hasError = true;
                }

                if (hasError) {
                    return; // Exit if there are validation errors
                    console.log("Error:");
                }

                // Send the form data using Fetch API
                fetch('/handle_contact', { // Using hard-coded action
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                        // 'X-CSRFToken': csrfToken // Uncomment if CSRF is enabled
                    },
                    body: JSON.stringify(formData)
                })
                    .then(response => {
                        // Check if response is OK
                        if (!response.ok) {
                            return response.json().then(data => {
                                throw data;
                            });
                        }
                        return response.json();
                    })
                    .then(data => {
                        console.log("Response Data:", data); // Debugging
                        if (data.success) {
                            formMessages.innerHTML = `<div class="success-message">${data.success}</div>`;
                            form.reset(); // Reset the form fields
                        } else if (data.errors) {
                            // Display server-side validation errors
                            if (data.errors.email) {
                                emailError.innerText = data.errors.email;
                                emailInput.classList.add('input-error');
                            }
                            if (data.errors.message) {
                                messageError.innerText = data.errors.message;
                                messageInput.classList.add('input-error');
                            }
                            if (data.errors.general) {
                                formMessages.innerHTML = `<div class="error-message-general">${data.errors.general}</div>`;
                                // Optionally, highlight both fields or specific ones
                                emailInput.classList.add('input-error');
                                messageInput.classList.add('input-error');
                            }
                        }
                    })
                    .catch(error => {
                        console.error('Fetch Error:', error);
                        if (error.errors && error.errors.general) {
                            formMessages.innerHTML = `<div class="error-message-general">${error.errors.general}</div>`;
                        } else {
                            formMessages.innerHTML = `<div class="error-message-general">An unexpected error occurred. Please try again later.</div>`;
                        }
                    });
            });

            // Helper function to validate email format
            function validateEmail(email) {
                // Simple email regex pattern
                const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                return re.test(email.toLowerCase());
            }
        });
    </script>
</body>

<footer class="footer">
    Copyright 2025 Jakub Domagała and Iga Kowalczyk
</footer>

</html>